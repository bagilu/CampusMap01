<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Supabase TblSpace 測試頁面</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      margin: 20px;
      padding: 0;
      background-color: #f7f7f7;
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    #status {
      margin: 10px 0;
      color: #555;
    }
    #error {
      color: #b00020;
      margin: 10px 0;
      white-space: pre-wrap;
    }
    ul {
      background: #fff;
      padding: 10px 15px;
      border-radius: 8px;
      list-style-type: none;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    li {
      padding: 4px 0;
      border-bottom: 1px solid #eee;
    }
    li:last-child {
      border-bottom: none;
    }
    code {
      background: #eee;
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>Supabase 測試：TblSpace 前 10 筆 spacename</h1>

  <div id="status">狀態：準備連線至 Supabase…</div>
  <div id="error"></div>
  <ul id="space-list"></ul>

  <!-- 1. 先載入存放 URL 與 Key 的 config.js（路徑與檔名請確認） -->
  <script src="./config.js"></script>

  <!-- 2. 載入 Supabase JS SDK (v2, CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <!-- 3. 主程式：建立連線、查詢 TblSpace、顯示結果 -->
  <script>
    // 檢查 config.js 是否正確載入
    if (typeof SUPABASE_URL === "undefined" || typeof SUPABASE_ANON_KEY === "undefined") {
      document.getElementById("status").textContent = "狀態：無法找到 SUPABASE_URL 或 SUPABASE_ANON_KEY";
      document.getElementById("error").textContent =
        "請確認 config.js 是否在同一個資料夾，且變數名稱正確。";
    } else {
      document.getElementById("status").textContent = "狀態：正在連線至 Supabase…";

      // 建立 supabase client（v2 寫法）
      const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      async function loadSpaces() {
        const statusEl = document.getElementById("status");
        const errorEl = document.getElementById("error");
        const listEl = document.getElementById("space-list");

        statusEl.textContent = "狀態：資料讀取中…";
        errorEl.textContent = "";
        listEl.innerHTML = "";

        // 等同 SQL: SELECT spacename FROM "TblSpace" LIMIT 10;
        const { data, error } = await supabaseClient
          .from("TblSpace")
          .select("spacename")
          .limit(10);

        if (error) {
          statusEl.textContent = "狀態：讀取失敗";
          errorEl.textContent = "錯誤訊息：\n" + error.message;
          console.error("Supabase error:", error);
          return;
        }

        statusEl.textContent = "狀態：讀取成功，共取得 " + data.length + " 筆資料";

        if (!data || data.length === 0) {
          listEl.innerHTML = "<li>沒有讀到任何 spacename 資料。</li>";
          return;
        }

        // 將每一筆 spacename 顯示為 <li>
        data.forEach((row, index) => {
          const li = document.createElement("li");
          li.textContent = (index + 1) + ". " + (row.spacename ?? "(null)");
          listEl.appendChild(li);
        });
      }

      // 一載入頁面就執行查詢
      loadSpaces();
    }
  </script>
</body>
</html>
